version: '3'

tasks:
  pub:outdated:
    vars:
      PACKAGE: '{{.PACKAGE | default ""}}'
    cmds:
      - |
        if [ "{{.PACKAGE}}" = "" ]; then
          flutter pub outdated
        else
          flutter pub outdated | GREP_COLOR='1;32' grep --color=always -E "{{.PACKAGE}}\s.*|$"
        fi
    silent: true
  
  pub:get:
    cmds:
      - flutter pub get
    silent: false

  pub:upgrade:
    vars:
      PACKAGE: '{{.PACKAGE | default ""}}'
    cmds:
      - |
        if [ "{{.PACKAGE}}" = "" ]; then
          flutter pub upgrade
        else
          flutter pub upgrade {{.PACKAGE}}
        fi
    silent: true


  analyze:app:
    cmds:
      - flutter analyze lib
    silent: false

  analyze:generated:
    cmds:
      - dart run custom_lint
    silent: false

  analyze:test:
    cmds:
      - flutter analyze test
    silent: false

  gen:
    vars:
      MODE: '{{.MODE | default "build"}}'
    preconditions:
      - sh: '[[ "{{.MODE}}" == "build" || "{{.MODE}}" == "watch" ]]'
        msg: "MODEには 'build' または 'watch' を指定してください。"
    cmds:
      - dart run build_runner {{.MODE}} --delete-conflicting-outputs
    silent: false

  gen:l10n:
    cmds:
      - flutter gen-l10n
    silent: false
  
  gen:icon:
    cmds:
      - flutter pub run flutter_launcher_icons:main
    silent: false

  run:
    cmds:
      - flutter run -d emulator-5554
    silent: false

  test:
    cmds:
      - flutter test
    silent: false

  test:integration:
    cmds:
      - flutter test integration_test
    silent: false
  
  clean:
    cmds:
      - flutter clean
    silent: false
